# 📝 创建 Google 服务账号 - 详细步骤

## 🎯 目标
创建一个服务账号，让后台管理系统可以访问你的 Google Sheets。

---

## 步骤 1: 登录 Google Cloud Console

1. 打开浏览器，访问：https://console.cloud.google.com/
2. 使用你的 Google 账号登录（`chu20170201@gmail.com`）
3. 如果是第一次使用，可能需要接受服务条款

---

## 步骤 2: 创建新项目（如果还没有项目）

### 2.1 选择或创建项目

1. 点击页面顶部的项目选择器（显示当前项目名称或"选择项目"）
2. 点击弹出窗口右上角的「**新建项目**」按钮

### 2.2 填写项目信息

1. **项目名称**：输入 `phone-query-admin`（或任何你喜欢的名称）
2. **位置**：选择"无组织"（默认即可）
3. 点击「**创建**」按钮

### 2.3 等待项目创建

- 等待 10-30 秒，页面会显示"项目创建中..."
- 创建完成后，会自动切换到新项目

---

## 步骤 3: 启用 Google Sheets API

### 3.1 打开 API 库

1. 在左侧菜单中，点击「**API 和服务**」
2. 点击「**库**」（Library）

### 3.2 搜索并启用 Google Sheets API

1. 在搜索框中输入：`Google Sheets API`
2. 点击搜索结果中的「**Google Sheets API**」
3. 点击「**启用**」按钮
4. 等待几秒钟，页面会显示"API 已启用"

---

## 步骤 4: 创建服务账号

### 4.1 打开服务账号页面

1. 在左侧菜单中，点击「**IAM 和管理**」
2. 点击「**服务账号**」

### 4.2 创建新服务账号

1. 点击页面顶部的「**+ 创建服务账号**」按钮

### 4.3 填写服务账号信息

**第一步：服务账号详情**

1. **服务账号名称**：输入 `phone-query-admin-service`（可以自定义）
2. **服务账号 ID**：会自动生成（可以保持默认）
3. **说明**：输入 `用于访问电话查询系统的 Google Sheets`（可选）
4. 点击「**创建并继续**」

**第二步：授予访问权限（可选）**

- 这个步骤可以跳过，因为我们只需要访问 Sheets，不需要项目权限
- 直接点击「**继续**」或「**完成**」

**第三步：完成**

- 点击「**完成**」按钮
- 服务账号创建成功！

---

## 步骤 5: 创建并下载密钥

### 5.1 打开服务账号

1. 在服务账号列表中，找到刚创建的账号（名称：`phone-query-admin-service`）
2. 点击服务账号的**邮箱地址**（格式类似：`phone-query-admin-service@项目名.iam.gserviceaccount.com`）

### 5.2 创建密钥

1. 点击「**密钥**」标签
2. 点击「**添加密钥**」按钮
3. 选择「**创建新密钥**」

### 5.3 选择密钥格式

1. 选择「**JSON**」格式
2. 点击「**创建**」按钮

### 5.4 下载密钥文件

- JSON 文件会自动下载到你的电脑（通常在「下载」文件夹）
- **重要**：这个文件包含敏感信息，请妥善保管！
- 文件名类似：`项目名-xxxxx-xxxxx.json`

---

## 步骤 6: 分享 Google Sheets 给服务账号

### 6.1 打开你的 Google Sheets

访问：https://docs.google.com/spreadsheets/d/1VulDP7Kk_Uirag_ggRb042FI4n0BV7ntEkjsyWSI9V0/edit

### 6.2 打开分享设置

1. 点击右上角的「**分享**」按钮

### 6.3 添加服务账号

1. 打开刚才下载的 JSON 文件
2. 找到 `"client_email"` 这一行，复制邮箱地址（例如：`phone-query-admin-service@xxx.iam.gserviceaccount.com`）
3. 在 Google Sheets 的分享对话框中，粘贴这个邮箱地址
4. **权限**：选择「**查看者**」（只需要读取权限）
5. **取消勾选**「通知用户」（这是机器人账号，不需要通知）
6. 点击「**分享**」按钮

---

## 步骤 7: 使用自动配置脚本

### 7.1 运行配置脚本

在终端中运行：
```bash
npm run setup
```

### 7.2 输入 JSON 文件路径

当脚本提示时，输入 JSON 文件的路径：

**方法 A：直接输入路径**
```
/Users/caijunchang/Downloads/项目名-xxxxx-xxxxx.json
```

**方法 B：拖拽文件**
- 直接将 JSON 文件从 Finder 拖拽到终端窗口
- 路径会自动填入

### 7.3 确认配置

- 脚本会显示配置摘要
- 确认后会自动生成 `.env.local` 文件

---

## ✅ 完成！

配置完成后：

1. **验证配置**：运行 `npm run test:config` 检查配置是否正确
2. **重启服务器**：如果服务器正在运行，需要重启：
   ```bash
   # 停止当前服务器（Ctrl + C）
   npm run dev
   ```
3. **测试访问**：打开 http://localhost:3000 查看数据

---

## 🐛 常见问题

### Q1: 找不到「API 和服务」菜单？
- 确保你已经创建了项目
- 尝试刷新页面

### Q2: 下载的 JSON 文件在哪里？
- 通常在「下载」文件夹
- 文件名类似：`项目名-随机字符.json`

### Q3: 分享时找不到服务账号邮箱？
- 打开下载的 JSON 文件
- 找到 `"client_email"` 这一行，复制邮箱地址

### Q4: 配置后还是无法访问数据？
- 检查服务账号是否已分享到 Google Sheets
- 检查权限是否为「查看者」或「编辑者」
- 运行 `npm run test:config` 查看详细错误信息

---

## 📞 需要帮助？

如果遇到问题：
1. 查看浏览器控制台的错误信息
2. 运行 `npm run test:config` 查看配置状态
3. 检查 JSON 文件格式是否正确
